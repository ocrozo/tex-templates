% Copyright (c) 2014 Stephane GALLAND <galland@arakhne.org>
%
% UTBM, IRTES  and SET logos and names are registered and owned by the
% "Universite de Technology of Belfort-Montbeliard".
% 
% This program is free library; you can redistribute it and/or modify
% it under the terms of the GNU Lesser General Public License as
% published by the Free Software Foundation; either version 3 of the
% License, or any later version.
%
% This library is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% Lesser General Public License for more details.
%
% You should have received a copy of the GNU Lesser General Public
% License along with this library; see the file COPYING.  If not,
% write to the Free Software Foundation, Inc., 59 Temple Place - Suite
% 330, Boston, MA 02111-1307, USA.
%
\ProvidesPackage{beamerbasethemeIRTES}
   [2014/09/10 Beamer Base Defs 'IRTES' Theme]

%%%%%%%--------------------------------------
%%%%%%% PREAMBLE DEFINITIONS
%%%%%%%--------------------------------------
\newcounter{@beamer@theme@irtes@finalslidelabel}
\setcounter{@beamer@theme@irtes@finalslidelabel}{0} %0: Thanks, 1: Questions, 2: user, 3: title

\gdef\beamer@theme@irtes@label@finalslidelabel{}

\newcounter{@beamer@theme@irtes@visualframenumber}
\setcounter{@beamer@theme@irtes@visualframenumber}{0} % 0: circle, 1: text, 2:section-circle,
                                                      % 3:part-circle, 4: section-part-circle

\newlength\beamer@theme@irtes@contentheight
\setlength{\beamer@theme@irtes@contentheight}{6cm}

\newboolean{beamer@theme@irtes@eventintitlebar}
\setboolean{beamer@theme@irtes@eventintitlebar}{true}

%%%%%%%--------------------------------------
%%%%%%% PACKAGE OPTIONS AND DEPENDENCIES
%%%%%%%--------------------------------------

%\RequirePackage[T1]{fontenc}
\RequirePackage{ifthen}
\RequirePackage{relsize}
\RequirePackage{hyphenat}
\RequirePackage{ifthen}
\RequirePackage{xspace}
\RequirePackage{xcolor}
\RequirePackage{url}
\RequirePackage{graphicx}
\RequirePackage{keyval}
\RequirePackage{amsmath}
\RequirePackage{amssymb}
\RequirePackage{pifont}
\RequirePackage{tikz}
\RequirePackage{environ}% for advanced environment declaration
\RequirePackage{textcomp}
\RequirePackage{colortbl}
\RequirePackage{translator} % Should be provided by Beamer, be sometime missed

\DeclareOptionBeamer{thanksslide}{\global\setcounter{@beamer@theme@irtes@finalslidelabel}{0}}
\DeclareOptionBeamer{questionslide}{\global\setcounter{@beamer@theme@irtes@finalslidelabel}{1}}
\DeclareOptionBeamer{repeattitleslide}{\global\setcounter{@beamer@theme@irtes@finalslidelabel}{3}}
\DeclareOptionBeamer{textnumberstyle}{%
	\global\setcounter{@beamer@theme@irtes@visualframenumber}{1}%
}
\DeclareOptionBeamer{circlenumberstyle}{%
	\global\setcounter{@beamer@theme@irtes@visualframenumber}{0}%
}
\DeclareOptionBeamer{sectioncirclenumberstyle}{%
	\global\setcounter{@beamer@theme@irtes@visualframenumber}{2}%
}
\DeclareOptionBeamer{partcirclenumberstyle}{%
	\global\setcounter{@beamer@theme@irtes@visualframenumber}{3}%
}
\DeclareOptionBeamer{partsectioncirclenumberstyle}{%
	\global\setcounter{@beamer@theme@irtes@visualframenumber}{4}%
}
\DeclareOptionBeamer{eventintitlebar}{%
	\setboolean{beamer@theme@irtes@eventintitlebar}{true}%
}
\DeclareOptionBeamer{eventbelowauthors}{%
	\setboolean{beamer@theme@irtes@eventintitlebar}{false}%
}
%\ExecuteOptionsBeamer{left}
\ProcessOptionsBeamer

%%%%%%%--------------------------------------
%%%%%%% PROTECTED API
%%%%%%%--------------------------------------

%-----------------------------------------
% Fixing a strange bug: the default color of the
% text is not the "normal text" color.
% Also reset the font in case of a bug! ;-)
\let\beamer@theme@irtes@old@frame\frame
\gdef\frame{\normalcolor\normalfont\beamer@theme@irtes@old@frame}

%-----------------------------------------
% Wrap the text formatting functions (for inside the titles)
\long\gdef\@beamer@theme@irtes@wraptextformats#1{%
	\let\@beamer@theme@irtes@oldtextsc\textsc%
	\def\textsc##1{\smaller\MakeUppercase{##1}\larger}#1%
	\let\textsc\@beamer@theme@irtes@oldtextsc%
}

%-----------------------------------------
% Put the first parameter at the end of the second
% parameter, iff the second parameter is not empty.
\gdef\@beamer@theme@irtes@postfix#1#2{\ifthenelse{\equal{a#2}{a}}{{}}{#2#1}}

%-----------------------------------------
% Localization support
\deftranslation[to=English]{ColumnChar}{:}
\deftranslation[to=English]{Thanks}{Thank you for your attention\dots}
\deftranslation[to=English]{Questions}{Questions\dots}
\deftranslation[to=French]{ColumnChar}{\,:}
\deftranslation[to=French]{Thanks}{Merci de votre attention\dots}
\deftranslation[to=French]{Questions}{Questions\dots}
\deftranslation[to=German]{ColumnChar}{ :}
\deftranslation[to=German]{Thanks}{Vielen dank f\"ur ihre aufmerksamkeit\dots}
\deftranslation[to=German]{Questions}{Fragen\dots}

%-----------------------------------------
% Thank slide
\gdef\beamer@theme@irtes@thanksslide{%
	\beamer@theme@irtes@outer@thanksslide%
	\global\let\beamer@theme@irtes@thanksslide\relax
}

%-----------------------------------------
% Visual progression indicator
%
% Parameters: (x,y){3:begin angle}{4:end angle}{5:radius}{6:fill color}{7:line color}{8:style}
\def\beamer@theme@irtes@pgf@pie(#1,#2)#3#4#5#6#7#8{%
	\pgfmathsetmacro{\beamer@theme@irtes@tmp}{0.5*(#3)+0.5*(#4)}%
	\path (#1,#2) -- ++(\beamer@theme@irtes@tmp:0) coordinate(FRAMEPROGRESS);%
	% slice
	\draw[line join=round, color=#7, fill=#6, #8] (FRAMEPROGRESS) -- ++(#3:#5) arc (#3:#4:#5) -- cycle;
}
% Parameters: {Number to display}{counter for the current page}{counter for the total number of pages}
\newcommand{\beamer@theme@irtes@pi@circle}[3]{%
	\begin{tikzpicture}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@endangle}{(360.0/(max(#3,1))*max(1,min(#2,#3))}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@startangle}{min(90-\beamer@theme@irtes@pi@endangle,90)}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@endangle}{max(90-\beamer@theme@irtes@pi@endangle,90)}%
		%
		\beamer@theme@irtes@pgf@pie(0,0){90}{450}{.32cm}{circle progress bar.bg}{circle progress bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){\beamer@theme@irtes@pi@startangle}{\beamer@theme@irtes@pi@endangle}{.27cm}{circle progress bar/first bar.bg}{circle progress bar/first bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){0}{360}{.18cm}{circle progress bar.bg}{circle progress bar.bg}{thick}
		\path[color=white] (FRAMEPROGRESS) node {\tiny\normalfont\usebeamercolor[fg]{circle progress bar}#1};
	\end{tikzpicture}%
}
% Parameters: {Number to display}{counter for the current page}{counter for the total number of pages}{counter for the current page in the section}{counter for the total number of pages in the section}
\newcommand{\beamer@theme@irtes@pi@seccircle}[5]{%
	\begin{tikzpicture}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@endangle}{(360.0/(max(#3,1))*max(1,min(#2,#3))}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@startangle}{min(90-\beamer@theme@irtes@pi@endangle,90)}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@endangle}{max(90-\beamer@theme@irtes@pi@endangle,90)}%
		%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@secendangle}{(360.0/max(#5,1))*min(#4,#5)}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@secstartangle}{min(90-\beamer@theme@irtes@pi@secendangle,90)}%
		\pgfmathsetmacro{\beamer@theme@irtes@pi@secendangle}{max(90-\beamer@theme@irtes@pi@secendangle,90)}%
		%
		\beamer@theme@irtes@pgf@pie(0,0){90}{450}{.32cm}{circle progress bar.bg}{circle progress bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){\beamer@theme@irtes@pi@startangle}{\beamer@theme@irtes@pi@endangle}{.27cm}{circle progress bar/first bar.bg}{circle progress bar/first bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){0}{360}{.235cm}{circle progress bar.bg}{circle progress bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){\beamer@theme@irtes@pi@secstartangle}{\beamer@theme@irtes@pi@secendangle}{.235cm}{circle progress bar/second bar.bg}{circle progress bar/second bar.bg}{thick}
		\beamer@theme@irtes@pgf@pie(0,0){0}{360}{.18cm}{circle progress bar.bg}{circle progress bar.bg}{thick}
		%
		\path[color=white] (FRAMEPROGRESS) node {\normalfont\tiny\usebeamercolor[fg]{circle progress bar}#1};
	\end{tikzpicture}%
}


%%%%%%%--------------------------------------
%%%%%%% PUBLIC API
%%%%%%%--------------------------------------

%-----------------------------------------
% Headlines
\global\let\beamer@theme@irtes@headline@default\relax
\global\gdef\beamer@theme@irtes@headline@current{\beamer@theme@irtes@headline@default}
\setbeamertemplate{headline}{\beamer@theme@irtes@headline@current}%
\setbeamertemplate{headline text style}{}%
\newcommand{\useheaderempty}{%
	\gdef\beamer@theme@irtes@headline@current{}%
}
\newcommand{\useheaderdefault}{%
	\gdef\beamer@theme@irtes@headline@current{\beamer@theme@irtes@headline@default}%
}

\newcommand{\insertheaderlinewithsections}{%
	\begin{picture}(0,0)(0,0)%
		\put(-4,11){\parbox[t]{2.65cm}{%
			\begin{flushleft}%
				\usebeamertemplate{headline text style}%
				\insertsectionnavigation{\linewidth}%
			\end{flushleft}%
			}%
		}%
	\end{picture}%
}
\newcommand{\useheaderlinewithsections}[1][]{%
	\gdef\beamer@theme@irtes@headline@default{\insertheaderlinewithsections}%
}

\pgfdeclareimage[width=2.3cm]{IRTESlogointitle}{irtes_logo_in_title}
\newcommand{\insertheaderlinewithirteslogo}{%
	\begin{picture}(0,0)(0,0)%
		\put(8,-40){%
			\pgfuseimage{IRTESlogointitle}%
		}%
	\end{picture}%
}
\newcommand{\useheaderlinewithirteslogo}[1][]{%
	\gdef\beamer@theme@irtes@headline@default{\insertheaderlinewithirteslogo}%
}

\useheaderlinewithirteslogo
\useheaderdefault

%-----------------------------------------
% Put something at an absolute position
\newcounter{beamer@theme@irtes@absolutepositionelements@cnt}
\setcounter{beamer@theme@irtes@absolutepositionelements@cnt}{0}

\long\def\putat(#1,#2)#3{%
	\global\addtocounter{beamer@theme@irtes@absolutepositionelements@cnt}{1}%
	\expandafter\gdef\csname @tmp@\arabic{beamer@theme@irtes@absolutepositionelements@cnt}\endcsname{\put(#1,#2){#3}}%
}
\newcommand{\beamer@theme@irtes@insertabsolutepositionelements}{%
	\whiledo{\arabic{beamer@theme@irtes@absolutepositionelements@cnt}>0}{%
		\csname @tmp@\arabic{beamer@theme@irtes@absolutepositionelements@cnt}\endcsname%
		\global\addtocounter{beamer@theme@irtes@absolutepositionelements@cnt}{-1}%
	}%
	\global\setcounter{beamer@theme@irtes@absolutepositionelements@cnt}{0}%
}

%-----------------------------------------
% Localized quotes
\def\selectguillemotfont{\fontencoding{T1}\fontfamily{cmr}\selectfont}
\def\guillemotleft{{\selectguillemotfont\symbol{19}}\,}
\def\guillemotright{\,{\selectguillemotfont\symbol{20}}}
\newcommand{\ukquote}[1]{{\textgravedbl\!\textit{#1}\textacutedbl}\xspace}
\newcommand{\frquote}[1]{{\guillemotleft#1\guillemotright}\xspace}
\newcommand{\latquote}[1]{\textit{#1}\xspace}

%-----------------------------------------
% Underline
\let\beamer@theme@irtes@oldunderline\underline
\renewcommand{\underline}[1]{\beamer@theme@irtes@oldunderline{\smash{#1}}}

%-----------------------------------------
% Emphasing
\let\beamer@theme@irtes@oldemph\emph
\renewcommand{\emph}[1]{{\usebeamercolor[fg]{emphased text}#1}}

\newcommand{\Emph}[1]{{\usebeamercolor[fg]{emphased text}\textbf{#1}}}

%-----------------------------------------
% Footnote
\let\beamer@theme@irtes@oldfootnote\footnote
\gdef\beamer@theme@irtes@footnote#1{%
	\global\let\oldthefootnote\thefootnote%
	\global\let\thefootnote\relax%
	\footnotetext{#1}%
	\global\let\thefootnote\oldthefootnote}
\gdef\footnote{\@ifstar\beamer@theme@irtes@footnote\beamer@theme@irtes@oldfootnote}

%-----------------------------------------
% Citation in footnote
\newcommand{\footcite}[1]{\footnote*{\cite{#1}}}

%-----------------------------------------
% Side note
\let\beamer@theme@irtes@sidenote\relax
\newcommand{\sidenote}[1]{%
	\gdef\beamer@theme@irtes@sidenote{#1}%
}

%-----------------------------------------
% Inline examples
\newcommand{\inlineexample}[1]{%
	\insertexamplelabel\ #1\xspace%
}
\newcommand{\inlineexamples}[1]{%
	\insertexampleslabel\ #1\xspace%
}
\newcommand{\insertexamplelabel}{%
	{\usebeamercolor[fg]{example text}\translate{Example}\translate{ColumnChar}}%
}
\newcommand{\insertexampleslabel}{%
	{\usebeamercolor[fg]{example text}\translate{Examples}\translate{ColumnChar}}%
}

%-----------------------------------------
% EVENT
\gdef\inserteventname{}
\gdef\insertshorteventname{}
\newcommand{\event}[2][1]{%
	\gdef\inserteventname{#2}%
	\ifthenelse{\equal{a#1}{a}}{%
		\gdef\insertshorteventname{#2}%
	}{%
		\gdef\insertshorteventname{#1}%
	}
}

%-----------------------------------------
% Option parameters
\newif\ifbeamer@theme@irtes@optlist@needdefault
\gdef\beamer@theme@irtes@optlist@parseparams#1=#2\@nil{%
	\ifthenelse{\equal{#2}{===}}{%
		\global\beamer@theme@irtes@optlist@needdefaulttrue%
	}{%
		\global\beamer@theme@irtes@optlist@needdefaultfalse%
	}%
}
\DeclareRobustCommand{\beamer@theme@irtes@optlist}[1]{%
	{\beamer@theme@irtes@optlist@parseparams #1====\@nil}%
}

%-----------------------------------------
% Slide numbering
\newcounter{beamer@theme@irtes@nav@previoussection}
\setcounter{beamer@theme@irtes@nav@previoussection}{0}
\newcounter{beamer@theme@irtes@nav@previouspart}
\setcounter{beamer@theme@irtes@nav@previouspart}{0}
\newcounter{beamer@theme@irtes@nav@tmp}
\newcounter{beamer@theme@irtes@appendixframenumber}
%
\newcommand{\beamer@theme@irtes@totalcoreframenumber}{\the\c@framenumber}
\newcommand{\inserttotalcoreframenumber}{1}
%
\newcommand{\beamer@theme@irtes@definesectionframenumber}[3]{\@namedef{beamer@theme@irtes@nav@sectionsize@#1@#2}{#3}}
\newcommand{\beamer@theme@irtes@sectionframenumber}[2]{%
	\expandafter\ifx\csname beamer@theme@irtes@nav@sectionsize@#1@#2\endcsname\relax%
		1%
	\else%
		\csname beamer@theme@irtes@nav@sectionsize@#1@#2\endcsname%
	\fi%
}
%
\newcommand{\beamer@theme@irtes@definepartframenumber}[2]{\@namedef{beamer@theme@irtes@nav@partsize@#1}{#2}}
\newcommand{\beamer@theme@irtes@partframenumber}[1]{%
	\expandafter\ifx\csname beamer@theme@irtes@nav@partsize@#1\endcsname\relax%
		1%
	\else%
		\csname beamer@theme@irtes@nav@partsize@#1\endcsname%
	\fi%
}
%
\newcommand{\insertframenumbering}[1][\value{@beamer@theme@irtes@visualframenumber}]{%
	\edef\beamer@theme@irtes@nav@tmpmode{#1}%
	\ifnum\the\c@framenumber>\beamer@theme@irtes@totalcoreframenumber%
		% The current frame is in the appendix
		\expandafter\setcounter{beamer@theme@irtes@appendixframenumber}{\inserttotalframenumber}%
		\expandafter\addtocounter{beamer@theme@irtes@appendixframenumber}{-\beamer@theme@irtes@totalcoreframenumber}%
		\addtocounter{beamer@theme@irtes@appendixframenumber}{-2}%
		\xdef\beamer@theme@irtes@pi@numberpages{\arabic{beamer@theme@irtes@appendixframenumber}}%
		%
		\setcounter{beamer@theme@irtes@appendixframenumber}{\c@framenumber}%
		\expandafter\addtocounter{beamer@theme@irtes@appendixframenumber}{-\beamer@theme@irtes@totalcoreframenumber}%
		\addtocounter{beamer@theme@irtes@appendixframenumber}{-2}%
		%
		\xdef\beamer@theme@irtes@pi@shortlabel{\roman{beamer@theme@irtes@appendixframenumber}}%
		\global\let\beamer@theme@irtes@pi@longlabel\beamer@theme@irtes@pi@shortlabel%
		\xdef\beamer@theme@irtes@pi@currentpage{\value{beamer@theme@irtes@appendixframenumber}}%
		%
		\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
		\addtocounter{beamer@theme@irtes@nav@tmp}{-\thebeamer@theme@irtes@nav@previoussection}%
		\xdef\beamer@theme@irtes@pi@seccurrentpage{\thebeamer@theme@irtes@nav@tmp}%
		\xdef\beamer@theme@irtes@pi@secnumberpages{\beamer@theme@irtes@sectionframenumber{\thepart}{\thesection}}%
	\else%
		% The current frame is in the core part of the document
		\ifnum\beamer@theme@irtes@nav@tmpmode=3%
			\def\beamer@theme@irtes@nav@tmpmode{0}% Force circles
			\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
			\addtocounter{beamer@theme@irtes@nav@tmp}{-\thebeamer@theme@irtes@nav@previouspart}%
			\xdef\beamer@theme@irtes@pi@shortlabel{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@longlabel{{\thebeamer@theme@irtes@nav@tmp}/{\beamer@theme@irtes@partframenumber{\thepart}}}%
			\xdef\beamer@theme@irtes@pi@currentpage{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@numberpages{\beamer@theme@irtes@partframenumber{\thepart}}%
			%
		\else\ifnum\beamer@theme@irtes@nav@tmpmode=4%
			\def\beamer@theme@irtes@nav@tmpmode{2}% Force circles with sections
			\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
			\addtocounter{beamer@theme@irtes@nav@tmp}{-\thebeamer@theme@irtes@nav@previouspart}%
			\xdef\beamer@theme@irtes@pi@shortlabel{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@longlabel{{\thebeamer@theme@irtes@nav@tmp}/{\beamer@theme@irtes@partframenumber{\thepart}}}%
			\xdef\beamer@theme@irtes@pi@currentpage{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@numberpages{\beamer@theme@irtes@partframenumber{\thepart}}%
			%
			\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
			\addtocounter{beamer@theme@irtes@nav@tmp}{-\thebeamer@theme@irtes@nav@previoussection}%
			\xdef\beamer@theme@irtes@pi@seccurrentpage{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@secnumberpages{\beamer@theme@irtes@sectionframenumber{\thepart}{\thesection}}%
		\else%
			\xdef\beamer@theme@irtes@pi@shortlabel{\insertframenumber}%
			\xdef\beamer@theme@irtes@pi@longlabel{{\insertframenumber}/{\inserttotalcoreframenumber}}%
			\xdef\beamer@theme@irtes@pi@currentpage{\insertframenumber}%
			\xdef\beamer@theme@irtes@pi@numberpages{\inserttotalcoreframenumber}%
			%
			\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
			\addtocounter{beamer@theme@irtes@nav@tmp}{-\thebeamer@theme@irtes@nav@previoussection}%
			\xdef\beamer@theme@irtes@pi@seccurrentpage{\thebeamer@theme@irtes@nav@tmp}%
			\xdef\beamer@theme@irtes@pi@secnumberpages{\beamer@theme@irtes@sectionframenumber{\thepart}{\thesection}}%
		\fi\fi%
	\fi%
	%
	\expandafter\ifcase\beamer@theme@irtes@nav@tmpmode%
		% Circle for the entire document
		\beamer@theme@irtes@pi@circle{\beamer@theme@irtes@pi@shortlabel}{\beamer@theme@irtes@pi@currentpage}{\beamer@theme@irtes@pi@numberpages}%
	\or
		% Text
		{\normalfont\usebeamercolor[fg]{circle progress bar}\beamer@theme@irtes@pi@longlabel}%
	\or%
		% Circle for the current section and for the entire document
		\ifnum\thesection<1% display a simple circle when no section started
			\beamer@theme@irtes@pi@circle{\beamer@theme@irtes@pi@shortlabel}{\beamer@theme@irtes@pi@currentpage}{\beamer@theme@irtes@pi@numberpages}%
		\else%
			\beamer@theme@irtes@pi@seccircle{\beamer@theme@irtes@pi@shortlabel}{\beamer@theme@irtes@pi@currentpage}{\beamer@theme@irtes@pi@numberpages}{\beamer@theme@irtes@pi@seccurrentpage}{\beamer@theme@irtes@pi@secnumberpages}%
		\fi%
	\else%
		% Circle for the entire document
		\beamer@theme@irtes@pi@circle{\beamer@theme@irtes@pi@shortlabel}{\beamer@theme@irtes@pi@currentpage}{\beamer@theme@irtes@pi@numberpages}%
	\fi%
}
%
\def\beamer@theme@irtes@nav@advancesection{%
	\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
	\addtocounter{beamer@theme@irtes@nav@tmp}{-\c@beamer@theme@irtes@nav@previoussection}%
	\setcounter{beamer@theme@irtes@nav@previoussection}{\c@framenumber}%
	%
	\immediate\write\@auxout{\string\@writefile{nav}{%
		\string\headcommand{\string\beamer@theme@irtes@definesectionframenumber{\thepart}{\thesection}{%
		\thebeamer@theme@irtes@nav@tmp}}}}%
}
%
\def\beamer@theme@irtes@nav@advancepart{%
	\setcounter{beamer@theme@irtes@nav@tmp}{\c@framenumber}%
	\addtocounter{beamer@theme@irtes@nav@tmp}{-\c@beamer@theme@irtes@nav@previouspart}%
	\setcounter{beamer@theme@irtes@nav@previouspart}{\c@framenumber}%
	%
	\immediate\write\@auxout{\string\@writefile{nav}{%
		\string\headcommand{\string\beamer@theme@irtes@definepartframenumber{\thepart}{%
		\thebeamer@theme@irtes@nav@tmp}}}}%
}

% Write data in the aux file
\AtEndDocument{%
	\beamer@theme@irtes@nav@advancesection%
	\addtocounter{section}{1}% To be sure that the 'thank' slide is not in the same section as the previous slide.
	\immediate\write\@auxout{\string\@writefile{nav}%
        {\noexpand\headcommand{\noexpand\def\noexpand\inserttotalcoreframenumber
		{\beamer@theme@irtes@totalcoreframenumber}}}}
}

%-----------------------------------------
% Parts

\let\beamer@theme@irtes@part@oldpart\part
\let\beamer@theme@irtes@part@oldbeamerpart\beamer@part

\newif\ifbeamer@theme@irtes@part@hasoptionparam
\newif\ifbeamer@theme@irtes@part@hasauthor
\newif\ifbeamer@theme@irtes@part@addintoc

\gdef\beamer@part[#1]#2{%
	\beamer@theme@irtes@part@oldbeamerpart[#1]{#2}%
	\ifbeamer@inlecture\else%
		\beamer@atbeginpart%
	\fi%
	\setbeamertemplate{footline}{}%
	\useheaderempty%
	\usebackgroundtemplate{\pgfuseimage{IRTEStitle}}%
	\frame{%
		\ifthenelse{\equal{a\beamer@theme@irtes@part@partlabel}{a}}{}{% Issue #19
			\protected@xdef\@currentlabel{\the\c@part}%
			\expandafter\label{\beamer@theme@irtes@part@partlabel}%
			\gdef\beamer@theme@irtes@part@partlabel{}%
		}%
		\partpage%
	}%
	\usebackgroundtemplate{\ifbeamer@plainframe\else\pgfuseimage{IRTESbackground}\fi}%
	\setbeamertemplate{footline}{\beamer@theme@irtes@outer@footline}%
	\ifbeamer@theme@irtes@part@addintoc%
		\addtocontents{toc}{\protect\beamer@partintoc{\the\c@part}{\beamer@partname}{\the\c@page}}%
	\fi%
	\useheaderdefault%
	\protected@xdef\@currentlabel{\the\c@part}% Issue #19
}


\define@key{beamerthemeirtespart}{author}{%
	\ifthenelse{\equal{a#1}{a}}{}{%
		\global\beamer@theme@irtes@part@hasauthortrue%
		\gdef\beamer@theme@irtes@part@theauthor{#1}%
	}
}
\define@key{beamerthemeirtespart}{title}{%
	\ifthenelse{\equal{a#1}{a}}{}{%
		\global\beamer@theme@irtes@part@hasoptionparamtrue%
		\gdef\beamer@theme@irtes@part@shorttitle{#1}%
	}%
}
\define@key{beamerthemeirtespart}{label}{%
	\gdef\beamer@theme@irtes@part@partlabel{#1}%
}

\newcommand{\beamer@theme@irtes@part@partmacro}[2][]{%
	\beamer@theme@irtes@optlist{#1}%
	\global\beamer@theme@irtes@part@hasoptionparamfalse%
	\global\beamer@theme@irtes@part@hasauthorfalse%
	\gdef\beamer@theme@irtes@part@partlabel{}%
	\ifbeamer@theme@irtes@optlist@needdefault%
		\setkeys{beamerthemeirtespart}{title=#1}%
	\else%
		\setkeys{beamerthemeirtespart}{#1}%
	\fi%
	\beamer@theme@irtes@nav@advancepart%
	\beamer@theme@irtes@nav@advancesection%
	\ifbeamer@theme@irtes@part@hasoptionparam%
		\def\@tmp{\expandafter\beamer@theme@irtes@part@oldpart[\beamer@theme@irtes@part@shorttitle]}%
	\else%
		\let\@tmp\beamer@theme@irtes@part@oldpart%
	\fi%
	% Reset sections's numbers when a part is started
	\c@section=0% From TeX background
	\beamer@tocsectionnumber=0% From Beamer background
	% Run the TeX \part macro
	\@tmp{#2}%
}

\def\beamer@theme@irtes@part@part{%
	\beamer@theme@irtes@part@addintoctrue%
	\beamer@theme@irtes@part@partmacro%
}

\def\beamer@theme@irtes@part@partstar{%
	\beamer@theme@irtes@part@addintocfalse%
	\beamer@theme@irtes@part@partmacro%
}

\gdef\part{\@ifstar\beamer@theme@irtes@part@partstar\beamer@theme@irtes@part@part}

% Part prefix in the slide
\let\insertpartprefix\relax
\newcommand{\partprefix}[2][\protect\Alph{part}]{%
	\gdef\insertpartprefix{#2~#1\protect\\}%
}
\newcommand{\resetpartprefix}{%
	\global\let\insertpartprefix\relax%
}

% Parts in the TOC
\define@key{beamertoc}{onlyparts}[]{%
	\beamer@toc@sectionstyle{hide}%
	\beamer@toc@subsectionstyle{hide}%
	\c@tocdepth=-1%
}

\newcount\beamer@partadjust
\beamer@partadjust=-2

\newcommand{\beamer@partintoc}[3]{%
	\ifnum\c@tocdepth=-1%
		\beamer@tempcount=#1%
		\edef\inserttocpartnumber{\expandafter\@Alph\beamer@tempcount}%
		\beamer@tempcount=#3%
		\advance\beamer@tempcount by\beamer@partadjust%
		\protected@edef\inserttocpart{\protect\hyperlink{Navigation\the\beamer@tempcount}{#2}}%
		\ifx\beamer@toc@ooss\beamer@hidetext%
			\vskip1.5em%
		\else%
			\vfill%
		\fi%
		{%
			\hbox{\vbox{%
				\leavevmode\normalsize\usebeamerfont*{section number projected}\usebeamercolor[bg]{section number projected}%
				\vrule width2.25ex height1.85ex depth.4ex%
				\hskip-2.25ex%
				\hbox to2.25ex{\hfil\color{fg}\inserttocpartnumber\hfil}%
				\kern1.25ex%
				\inserttocpart\par%
			}}%
			\par%
		}%
	\fi%
}

%-----------------------------------------
% Sections

\let\beamer@theme@irtes@nav@oldsection\section
\gdef\section{%
	\beamer@theme@irtes@nav@advancesection%
	\beamer@theme@irtes@nav@oldsection%
}

%-----------------------------------------
% Institute
\gdef\beamer@theme@irtes@instituteurl{http://irtes.utbm.fr}
\newcommand{\instituteurl}[1]{%
	\gdef\beamer@theme@irtes@instituteurl{#1}
}
\newcommand{\insertinstituteurl}{%
	\expandafter\url{\beamer@theme@irtes@instituteurl}%
}
\institute[IRTES]{
	\textbf{Universit\'e de Technologie de Belfort-Montb\'eliard}, \\[0cm]
	90010 Belfort cedex, France - \expandafter\url{\beamer@theme@irtes@instituteurl}
}

%-----------------------------------------
% Partner Logo
\gdef\beamer@theme@irtes@partnerlogo{}
\newcommand{\beamer@theme@irtes@partnerlogo@search}[1]{%
	\IfFileExists{#1}{%
                \gdef\beamer@theme@irtes@partnerlogo@tmp{#1}%
        }{%
                \@for\beamer@theme@irtes@partnerlogo@pathtmp:=\Ginput@path\do{%
                        \ifx\beamer@theme@irtes@partnerlogo@tmp\relax%
                                \IfFileExists{\beamer@theme@irtes@partnerlogo@pathtmp#1}{%
                                        \xdef\beamer@theme@irtes@partnerlogo@tmp{\beamer@theme@irtes@partnerlogo@pathtmp#1}%
                                }{}%
                        \fi%
                }%
        }%
}
\newcommand{\partnerlogo}[2][width=2cm]{%
	\begingroup%
        %
        \global\let\beamer@theme@irtes@partnerlogo@tmp\relax%
        \filename@parse{#2}%
        \ifx\filename@ext\relax%
                \@for\beamer@theme@irtes@partnerlogo@exttmp:=\Gin@extensions\do{%
                        \beamer@theme@irtes@partnerlogo@search{#2\beamer@theme@irtes@partnerlogo@exttmp}%
                }%
        \else%
                \beamer@theme@irtes@partnerlogo@search{#2}%
        \fi%
        %
        \ifx\@autolatex@wtfig@tmp\relax%
                \errmessage{Package Beamer/IRTES: File not found '#2', needed for Partner Logo.}%
        \else%
		\expandafter\pgfdeclareimage[#1]{IRTESpartnerlogo}{\beamer@theme@irtes@partnerlogo@tmp}%
		\gdef\beamer@theme@irtes@partnerlogo{\pgfuseimage{IRTESpartnerlogo}}%
        \fi%
	%
        \endgroup%
}

%-----------------------------------------
% Table of content
\newcommand{\tableofcontentslide}[1][hideallsubsections]{%
	\begin{frame}[c]{\translate{Outline}}%
	\small\tableofcontents[#1]%
	\end{frame}%
}

%-----------------------------------------
% Slide Environment
\newenvironment{slide}[2][t]{%
	\PackageWarning{IRTES Beamer Style}{Environment 'slide' is deprecated}%
	\begin{frame}[#1]{#2}%
}{%
	\end{frame}%
}

%-----------------------------------------
% Slide Environment with only a figure
\newsavebox{\beamer@theme@irtes@figureslide@box}
\newlength{\beamer@theme@irtes@figureslide@width}
\newlength{\beamer@theme@irtes@figureslide@height}
\newif\ifbeamer@theme@irtes@figureslide@dynamic@width
\newif\ifbeamer@theme@irtes@figureslide@dynamic@height
\define@key{beamerthemeirtesfigureslide}{width}{%
	\gdef\beamer@theme@irtes@figureslide@widtht{#1}%
	\global\beamer@theme@irtes@figureslide@dynamic@widthfalse%
}
\define@key{beamerthemeirtesfigureslide}{height}{%
	\gdef\beamer@theme@irtes@figureslide@heightt{#1}%
	\global\beamer@theme@irtes@figureslide@dynamic@heightfalse%
}
\define@key{beamerthemeirtesfigureslide}{scale}{%
	\gdef\beamer@theme@irtes@figureslide@scale{#1}%
}
\newcommand{\figureslide}[3][]{%
	\global\beamer@theme@irtes@figureslide@dynamic@widthtrue%
	\global\beamer@theme@irtes@figureslide@dynamic@heighttrue%
	\gdef\beamer@theme@irtes@figureslide@scale{1}%
	\setkeys{beamerthemeirtesfigureslide}{#1}%
	\savebox{\beamer@theme@irtes@figureslide@box}{\includegraphics[width=\paperwidth]{#3}}%
	\begin{frame}[c]{#2}%
		\begin{center}%
			\ifbeamer@theme@irtes@figureslide@dynamic@width%
				\ifbeamer@theme@irtes@figureslide@dynamic@height%
					\settowidth{\beamer@theme@irtes@figureslide@width}{\usebox{\beamer@theme@irtes@figureslide@box}}%
					\settoheight{\beamer@theme@irtes@figureslide@height}{\usebox{\beamer@theme@irtes@figureslide@box}}%
					\pgfmathsetmacro{\beamer@theme@irtes@figureslide@ratiow}{\strip@pt\beamer@theme@irtes@figureslide@width / \strip@pt\linewidth}%
					\pgfmathsetmacro{\beamer@theme@irtes@figureslide@ratioh}{\strip@pt\beamer@theme@irtes@figureslide@height / \strip@pt\beamer@theme@irtes@contentheight}%
					\pgfmathtruncatemacro{\beamer@theme@irtes@figureslide@ratio}{\beamer@theme@irtes@figureslide@ratiow / \beamer@theme@irtes@figureslide@ratioh}%
					\ifthenelse{\beamer@theme@irtes@figureslide@ratio=0}{%
						\resizebox{!}{\beamer@theme@irtes@figureslide@scale\beamer@theme@irtes@contentheight}{\usebox{\beamer@theme@irtes@figureslide@box}}
					}{%
						\resizebox{\beamer@theme@irtes@figureslide@scale\linewidth}{!}{\usebox{\beamer@theme@irtes@figureslide@box}}
					}%
				\else%
					\resizebox{!}{\beamer@theme@irtes@figureslide@scale\beamer@theme@irtes@figureslide@heightt}{\usebox{\beamer@theme@irtes@figureslide@box}}
				\fi%
			\else%
				\ifbeamer@theme@irtes@figureslide@dynamic@height%
					\resizebox{\beamer@theme@irtes@figureslide@scale\beamer@theme@irtes@figureslide@widtht}{!}{\beamer@theme@irtes@figureslide@scale\usebox{\beamer@theme@irtes@figureslide@box}}
				\else%
					\resizebox{\beamer@theme@irtes@figureslide@scale\beamer@theme@irtes@figureslide@widtht}{\beamer@theme@irtes@figureslide@scale\beamer@theme@irtes@figureslide@heightt}{\usebox{\beamer@theme@irtes@figureslide@box}}
				\fi%
			\fi%
		\end{center}%
	\end{frame}%
}


%-----------------------------------------
% Bibliography
\newif\ifbeamer@theme@irtes@bibliographystyle
\beamer@theme@irtes@bibliographystylefalse
\global\let\beamer@theme@irtes@oldbibliographystyle\bibliographystyle
\renewcommand{\bibliographystyle}[1]{%
	\beamer@theme@irtes@bibliographystyletrue%
	\beamer@theme@irtes@oldbibliographystyle{#1}%
}
\global\let\beamer@theme@irtes@oldbibliography\bibliography
\renewcommand{\bibliography}[1]{%
	\AtEndDocument{%
		\appendix%
		\beamer@theme@irtes@bibliographyslide{#1}%
	}%
}
\newcommand{\beamer@theme@irtes@bibliographyslide}[1]{%
	\section{\bibname}%
	\begin{frame}[t,allowframebreaks]%
	\frametitle{\bibname}%
	\tiny%
	\ifbeamer@theme@irtes@bibliographystyle\else%
		\beamer@theme@irtes@oldbibliographystyle{irtes}%
	\fi%
	\beamer@theme@irtes@oldbibliography{#1}%
	\end{frame}%
}

% Remove icons from the bibliography
\setbeamertemplate{bibliography item}{}

%-----------------------------------------
% Appendix
\global\let\beamer@theme@irtes@oldappendix\appendix
\renewcommand{\appendix}{%
	\resetpartprefix%
	\let\beamer@theme@irtes@oldpart\part%
	\def\part{\beamer@theme@irtes@oldpart*}%
	\beamer@theme@irtes@thanksslide%
	\beamer@theme@irtes@oldappendix%
	\global\let\beamer@theme@irtes@oldappendix\relax%
	\let\part\beamer@theme@irtes@oldpart%
}

%-----------------------------------------
% Default Graphics Configuration
\DeclareGraphicsExtensions{.pdf,.png,.jpg,.jpeg}

%-----------------------------------------
% Symbols
\renewcommand{\copyright}{\Pisymbol{psy}{211}\xspace}
\newcommand{\trademark}{\Pisymbol{psy}{228}\xspace}
\newcommand{\regmark}{\Pisymbol{psy}{226}\xspace}

%-----------------------------------------
% Alert box
\def\beamer@theme@irtes@alertbox@noframed#1{%
	\expandafter\begin{beamercolorbox}[wd=\linewidth,rounded=true,shadow=true]{\beamer@theme@irtes@alertbox@style}%
		\centering\nohyphens{#1}%
	\end{beamercolorbox}%
}
\def\beamer@theme@irtes@alertbox@framed<#1>#2{%
	\only<#1>{%
		\begin{beamercolorbox}[wd=\linewidth,rounded=true,shadow=true]{block body alerted}%
			\centering\nohyphens{#2}%
		\end{beamercolorbox}%
	}%
}
\def\beamer@theme@irtes@alertbox@nostar{%
	\gdef\beamer@theme@irtes@alertbox@style{block body alerted}%
	\@ifnextchar<\beamer@theme@irtes@alertbox@framed\beamer@theme@irtes@alertbox@noframed%
}
\def\beamer@theme@irtes@alertbox@star{%
	\gdef\beamer@theme@irtes@alertbox@style{block body remark}%
	\@ifnextchar<\beamer@theme@irtes@alertbox@framed\beamer@theme@irtes@alertbox@noframed%
}
\def\alertbox{\@ifstar\beamer@theme@irtes@alertbox@star\beamer@theme@irtes@alertbox@nostar}

%-----------------------------------------
% Description environment with bullets
\let\beamer@theme@irtes@olditem\item
\def\beamer@theme@irtes@description@afterseparator{\translate{ColumnChar}}
\newcommand{\beamer@theme@irtes@itemc}[1][]{\ifthenelse{\equal{a#1}{a}}{}{%
	\ifthenelse{\equal{a#1}{a}}{}{%
	{\usebeamercolor[fg]{description item}#1\beamer@theme@irtes@description@afterseparator}\xspace}%
}}
\long\def\beamer@theme@irtes@itema<#1>{%
	\beamer@theme@irtes@olditem<#1>\relax\beamer@theme@irtes@itemc%
}
\long\def\beamer@theme@irtes@itemb{%
	\beamer@theme@irtes@olditem\relax\beamer@theme@irtes@itemc%
}
\renewenvironment{description}[1][]{%
	\begingroup%
	\itemize
	\global\let\beamer@theme@irtes@olditem\item%
	\renewcommand{\item}{\@ifnextchar<{\beamer@theme@irtes@itema}{\beamer@theme@irtes@itemb}}%
}{%
	\global\let\item\beamer@theme@irtes@olditem%
	\enditemize%
	\endgroup%
}

%-----------------------------------------
% Joint Enumeration/Description environment
\let\beamer@theme@irtes@oldenumerate\enumerate
\let\endbeamer@theme@irtes@oldenumerate\endenumerate
\renewenvironment{enumerate}[1][]{%
	\begingroup%
	\ifthenelse{\equal{a#1}{a}}{\def\@tmp{}}{\def\@tmp{[#1]}}%
	\expandafter\beamer@theme@irtes@oldenumerate\@tmp%
	\global\let\beamer@theme@irtes@olditem\item%
	\renewcommand{\item}{\@ifnextchar<{\beamer@theme@irtes@itema}{\beamer@theme@irtes@itemb}}%
}{%
	\global\let\item\beamer@theme@irtes@olditem%
	\endbeamer@theme@irtes@oldenumerate%
	\endgroup%
}
%\newcounter{@beamer@theme@irtes@enumdescription@cnt@}
%\newcommand{\beamer@theme@irtes@enumdescription@fmt@}[1]{}
%\newcommand{\enumdescriptionlabel}[1]{\textbf{#1}}
%\newenvironment{enumdescriptionx}[3][i]{%
%	\begingroup\setcounter{@upm@fmt@enumdescription@cnt@}{1}%
%	\let\upm@fmt@enumdescription@savedlabel\@currentlabel%
%	\ifthenelse{\equal{#1}{a}}{%
%		\renewcommand{\upm@fmt@enumdescription@fmt@}[1]{#2\alph{##1}#3}%
%	}{%
%		\ifthenelse{\equal{#1}{i}}{%
%			\renewcommand{\upm@fmt@enumdescription@fmt@}[1]{#2\roman{##1}#3}%
%		}{%
%			\renewcommand{\upm@fmt@enumdescription@fmt@}[1]{#2\expandafter{\csname the##1\endcsname}#3}%
%		}%
%	}%
%	\begin{list}{}{%
%		\renewcommand{\makelabel}[1]{\xdef\@currentlabel{\upm@fmt@enumdescription@fmt@{@upm@fmt@enumdescription@cnt@}}\enumdescriptionlabel{\@currentlabel~-~##1}:~{\addtocounter{@upm@fmt@enumdescription@cnt@}{1}}}%
%		\settowidth{\labelwidth}{iii)~}%
%	}
%}{%
%	\global\let\@currentlabel\upm@fmt@enumdescription@savedlabel%
%	\end{list}\endgroup%
%}
%\newenvironment{enumdescription}[1][i]{%
%	\begin{enumdescriptionx}[#1]{}{}%
%}{%
%	\end{enumdescriptionx}%
%}

%-----------------------------------------
% Exponents and Indices
\renewcommand{\textup}[1]{\textsuperscript{#1}\xspace}
\def\@textsubscript#1{%
  {\m@th\ensuremath{_{\mbox{\fontsize\sf@size\z@#1}}}}}
\newcommand{\textsubscript}[1]{\@textsubscript{\selectfont#1}}
\newcommand{\textdown}[1]{\textsubscript{#1}\xspace}

%-----------------------------------------
% Links to external resources
\newsavebox{\beamer@theme@irtes@externalresource@box@a}
\newsavebox{\beamer@theme@irtes@externalresource@box@b}
\newlength{\beamer@theme@irtes@externalresource@height}
\newlength{\beamer@theme@irtes@externalresource@width}
\newcommand{\beamer@theme@irtes@makelink}[3]{%
	\savebox{\beamer@theme@irtes@externalresource@box@a}{#1}%
	\savebox{\beamer@theme@irtes@externalresource@box@b}{\beamergotobutton{\usebox{\beamer@theme@irtes@externalresource@box@a}}}%
	\settoheight{\beamer@theme@irtes@externalresource@height}{\usebox{\beamer@theme@irtes@externalresource@box@a}}%
	\settowidth{\beamer@theme@irtes@externalresource@width}{\usebox{\beamer@theme@irtes@externalresource@box@b}}%
	\beamer@theme@irtes@makelink@do{#3#2}{%
		\vbox to \the\beamer@theme@irtes@externalresource@height{%
		\vfil \hbox to \the\beamer@theme@irtes@externalresource@width{%
			\raisebox{-\beamer@theme@irtes@externalresource@height}{%
				\usebox{\beamer@theme@irtes@externalresource@box@b}%
			}%
		}\vfil}%
	}%
}
\newcommand{\videolink}[3][]{%
	\global\let\beamer@theme@irtes@makelink@do\href%
	\beamer@theme@irtes@makelink{\includegraphics[#1]{#3}}{#2}{run:}%
	\global\let\beamer@theme@irtes@makelink@do\relax%
}

\newcommand{\picturegoto}[3][]{%
	\global\let\beamer@theme@irtes@makelink@do\hyperlink%
	\beamer@theme@irtes@makelink{\includegraphics[#1]{#3}}{#2}{}%
	\global\let\beamer@theme@irtes@makelink@do\relax%
}

%-----------------------------------------
% Label for the final slide
\newcommand{\finalslidetext}[1]{%
	\global\setcounter{@beamer@theme@irtes@finalslidelabel}{2}%
	\gdef\beamer@theme@irtes@label@finalslidelabel{#1}%
}

%-----------------------------------------
% Adjust Box
%
\newsavebox{\beamer@theme@irtes@adjustbox@content}
\newlength{\beamer@theme@irtes@adjustbox@left}
\newlength{\beamer@theme@irtes@adjustbox@right}
\newlength{\beamer@theme@irtes@adjustbox@top}
\newlength{\beamer@theme@irtes@adjustbox@bottom}
\newlength{\beamer@theme@irtes@adjustbox@width}
\newlength{\beamer@theme@irtes@adjustbox@height}
\define@key{beamerthemeirtesadjustbox}{left}{%
	\setlength{\beamer@theme@irtes@adjustbox@left}{#1}%
}
\define@key{beamerthemeirtesadjustbox}{right}{%
	\setlength{\beamer@theme@irtes@adjustbox@right}{#1}%
}
\define@key{beamerthemeirtesadjustbox}{top}{%
	\setlength{\beamer@theme@irtes@adjustbox@top}{#1}%
}
\define@key{beamerthemeirtesadjustbox}{bottom}{%
	\setlength{\beamer@theme@irtes@adjustbox@bottom}{#1}%
}
\define@key{beamerthemeirtesadjustbox}{size}{%
	\setlength{\beamer@theme@irtes@adjustbox@left}{#1}%
	\setlength{\beamer@theme@irtes@adjustbox@right}{#1}%
	\setlength{\beamer@theme@irtes@adjustbox@top}{#1}%
	\setlength{\beamer@theme@irtes@adjustbox@bottom}{#1}%
}
\DeclareRobustCommand{\adjustbox}[2][]{%
	\setlength{\beamer@theme@irtes@adjustbox@left}{1em}%
	\setlength{\beamer@theme@irtes@adjustbox@right}{1em}%
	\setlength{\beamer@theme@irtes@adjustbox@top}{1em}%
	\setlength{\beamer@theme@irtes@adjustbox@bottom}{1em}%
	\setkeys{beamerthemeirtesadjustbox}{#1}%
	\sbox{\beamer@theme@irtes@adjustbox@content}{#2}%
	\setlength{\beamer@theme@irtes@adjustbox@width}{\the\wd\beamer@theme@irtes@adjustbox@content}%
	\addtolength{\beamer@theme@irtes@adjustbox@width}{\beamer@theme@irtes@adjustbox@left}%
	\addtolength{\beamer@theme@irtes@adjustbox@width}{\beamer@theme@irtes@adjustbox@right}%
	\setlength{\beamer@theme@irtes@adjustbox@height}{\the\ht\beamer@theme@irtes@adjustbox@content}%
	\addtolength{\beamer@theme@irtes@adjustbox@height}{\beamer@theme@irtes@adjustbox@top}%
	\addtolength{\beamer@theme@irtes@adjustbox@height}{\beamer@theme@irtes@adjustbox@bottom}%
	\vbox to \beamer@theme@irtes@adjustbox@height {%
		\vspace{\beamer@theme@irtes@adjustbox@top}%
		\hbox to \beamer@theme@irtes@adjustbox@width {%
			\hspace{\beamer@theme@irtes@adjustbox@left}%
			\usebox{\beamer@theme@irtes@adjustbox@content}%
		}%
	}%
}

%-----------------------------------------
% Zoomable Box
%
\newsavebox{\beamer@theme@irtes@zoombox@content}
\newcounter{beamer@theme@irtes@zoombox@counter}
\newlength{\beamer@theme@irtes@zoombox@borderlength}
\gdef\beamer@theme@irtes@zoombox@borderwidth{0}
\newlength{\beamer@theme@irtes@zoombox@left}
\newlength{\beamer@theme@irtes@zoombox@right}
\newlength{\beamer@theme@irtes@zoombox@top}
\newlength{\beamer@theme@irtes@zoombox@bottom}
\newlength{\beamer@theme@irtes@zoombox@zoomwidth}
\newlength{\beamer@theme@irtes@zoombox@zoomheight}
\define@key{beamerthemeirteszoombox}{border}{%
	\ifthenelse{\equal{a#1}{atrue}}{%
		\xdef\beamer@theme@irtes@zoombox@borderwidth{0.1}%
	}{%
		\ifthenelse{\equal{a#1}{afalse}}{%
			\xdef\beamer@theme@irtes@zoombox@borderwidth{0}%
		}{%
			\setlength{\beamer@theme@irtes@zoombox@borderlength}{#1}%
			\xdef\beamer@theme@irtes@zoombox@borderwidth{\strip@pt\beamer@theme@irtes@zoombox@borderlength}%
		}
	}%
}
\define@key{beamerthemeirteszoombox}{margin}{%
	\ifthenelse{\equal{a#1}{atrue}}{%
		\setlength{\beamer@theme@irtes@zoombox@left}{1em}%
		\setlength{\beamer@theme@irtes@zoombox@right}{1em}%
		\setlength{\beamer@theme@irtes@zoombox@top}{1em}%
		\setlength{\beamer@theme@irtes@zoombox@bottom}{1em}%
	}{%
		\ifthenelse{\equal{a#1}{afalse}}{%
			\setlength{\beamer@theme@irtes@zoombox@left}{0pt}%
			\setlength{\beamer@theme@irtes@zoombox@right}{0pt}%
			\setlength{\beamer@theme@irtes@zoombox@top}{0pt}%
			\setlength{\beamer@theme@irtes@zoombox@bottom}{0pt}%
		}{%
			\setlength{\beamer@theme@irtes@zoombox@left}{#1}%
			\setlength{\beamer@theme@irtes@zoombox@right}{#1}%
			\setlength{\beamer@theme@irtes@zoombox@top}{#1}%
			\setlength{\beamer@theme@irtes@zoombox@bottom}{#1}%
		}
	}%
}
\define@key{beamerthemeirteszoombox}{left}{%
	\setlength{\beamer@theme@irtes@zoombox@left}{#1}%
}
\define@key{beamerthemeirteszoombox}{right}{%
	\setlength{\beamer@theme@irtes@zoombox@right}{#1}%
}
\define@key{beamerthemeirteszoombox}{top}{%
	\setlength{\beamer@theme@irtes@zoombox@top}{#1}%
}
\define@key{beamerthemeirteszoombox}{bottom}{%
	\setlength{\beamer@theme@irtes@zoombox@bottom}{#1}%
}
% Parameters: [border=XXpt,left=XXpt,right=XXpt,top=XXpt,bottom=XXpt,margin=XXpt]{box content}
\newcommand{\zoombox}[2][]{%
	\setlength{\beamer@theme@irtes@zoombox@borderlength}{0pt}%
	\setlength{\beamer@theme@irtes@zoombox@left}{1em}%
	\setlength{\beamer@theme@irtes@zoombox@right}{1em}%
	\setlength{\beamer@theme@irtes@zoombox@top}{1em}%
	\setlength{\beamer@theme@irtes@zoombox@bottom}{1em}%
	\setkeys{beamerthemeirteszoombox}{#1}%
	\leavevmode%
	\sbox\beamer@theme@irtes@zoombox@content{#2}%
	\ifx\pdfdest\@undefined%
		\PackageWarning{beamerirtes}{The \zoombox is not supported by your TeX tool.}%
	\else%
		%Put an anchor in the PDF for the "standard" documentation (not zommed).
		\pdfdest name {zb\thebeamer@theme@irtes@zoombox@counter.out} fit%
		%
		%Put an anchor in the PDF for the "zooming" documentation.
		%Set the sizes of the zooming area.
		\setlength{\beamer@theme@irtes@zoombox@zoomwidth}%
				{\the\wd\beamer@theme@irtes@zoombox@content}%
		\addtolength{\beamer@theme@irtes@zoombox@zoomwidth}{\beamer@theme@irtes@zoombox@left}%
		\addtolength{\beamer@theme@irtes@zoombox@zoomwidth}{\beamer@theme@irtes@zoombox@right}%
		\setlength{\beamer@theme@irtes@zoombox@zoomheight}%
				{\the\ht\beamer@theme@irtes@zoombox@content}%
		\addtolength{\beamer@theme@irtes@zoombox@zoomheight}{\beamer@theme@irtes@zoombox@top}%
		\addtolength{\beamer@theme@irtes@zoombox@zoomheight}{\beamer@theme@irtes@zoombox@bottom}%
		\vbox to \beamer@theme@irtes@zoombox@top {%
			\hbox to \beamer@theme@irtes@zoombox@left {%
				\pdfdest name {zb\thebeamer@theme@irtes@zoombox@counter.in} fitr%
				width  \beamer@theme@irtes@zoombox@zoomwidth\space%
				height \beamer@theme@irtes@zoombox@zoomheight\space%
				depth  \the\dp\beamer@theme@irtes@zoombox@content\space%
			}%
		}
		%
		%Put the link that permits to zoom.
		\immediate\pdfannot%
		width  \the\wd\beamer@theme@irtes@zoombox@content\space%
		height \the\ht\beamer@theme@irtes@zoombox@content\space%
		depth  \the\dp\beamer@theme@irtes@zoombox@content\space%
		{%
			/Subtype/Link/H/N
			/Border [0 0 \beamer@theme@irtes@zoombox@borderwidth [1 2]]
			/A <<
				/S/JavaScript
				/JS (
					if(typeof(zoomed\thebeamer@theme@irtes@zoombox@counter)=='undefined'){
					  this.gotoNamedDest('zb\thebeamer@theme@irtes@zoombox@counter.out');
					  var zoomed\thebeamer@theme@irtes@zoombox@counter=false;
					}
				)
				/Next <<
					/S/GoTo/D (zb\thebeamer@theme@irtes@zoombox@counter.in)
					/Next <<
					  /S/JavaScript
					  /JS(
						if(zoomed\thebeamer@theme@irtes@zoombox@counter){
							this.gotoNamedDest('zb\thebeamer@theme@irtes@zoombox@counter.out');
							zoomed\thebeamer@theme@irtes@zoombox@counter=false;
						}else{
							zoomed\thebeamer@theme@irtes@zoombox@counter=true;
						}
					  )
					>>
				>>
			>>
		}%
	\fi%
	\usebox{\beamer@theme@irtes@zoombox@content}%
	\stepcounter{beamer@theme@irtes@zoombox@counter}%
}

%-----------------------------------------
% Extended Author API
%
\let\beamer@theme@irtes@authors@short\relax
\let\beamer@theme@irtes@authors@long\relax
\newcommand{\beamer@theme@irtes@authors@format@long}[1]{\underline{#1}}
\newcommand{\beamer@theme@irtes@authors@format@short}[1]{\textbf{#1}}
\newcommand{\beamer@theme@irtes@authors@longprefix}[1]{#1}
\newcommand{\beamer@theme@irtes@authors@shortprefix}[1]{#1}
\newcommand{\beamer@theme@irtes@buildauthorlist}[2][]{%
	% Build the long list of authors
	\ifx\beamer@theme@irtes@authors@long\relax%
		\protected@xdef\beamer@theme@irtes@authors@long{\beamer@theme@irtes@authors@longprefix{\protect{#2}}}%
	\else%
		\protected@xdef\beamer@theme@irtes@authors@long{\beamer@theme@irtes@authors@long \protect\and \beamer@theme@irtes@authors@longprefix{\protect{#2}}}%
	\fi%
	% Build the short list of authors
	\ifx\beamer@theme@irtes@authors@short\relax%
		\protected@xdef\beamer@theme@irtes@authors@short{\beamer@theme@irtes@authors@shortprefix{\protect{#1}}}%
	\else%
		\protected@xdef\beamer@theme@irtes@authors@short{\beamer@theme@irtes@authors@short \protect\and \beamer@theme@irtes@authors@shortprefix{\protect{#1}}}%
	\fi%
	% Give the two lists to Beamer
	\expandafter\author[\beamer@theme@irtes@authors@short]{\beamer@theme@irtes@authors@long}%
}
\newcommand{\beamer@theme@irtes@addauthorstar}{%
	\renewcommand{\beamer@theme@irtes@authors@longprefix}[1]{\protect\beamer@theme@irtes@authors@format@long{##1}}
	\renewcommand{\beamer@theme@irtes@authors@shortprefix}[1]{\protect\beamer@theme@irtes@authors@format@short{##1}}
	\beamer@theme@irtes@buildauthorlist}
\newcommand{\beamer@theme@irtes@addauthor}{
	\renewcommand{\beamer@theme@irtes@authors@longprefix}[1]{##1}
	\renewcommand{\beamer@theme@irtes@authors@shortprefix}[1]{##1}
	\beamer@theme@irtes@buildauthorlist}
\newcommand{\addauthor}{\@ifstar\beamer@theme@irtes@addauthorstar\beamer@theme@irtes@addauthor}

%---------------------------------------------
% LIBRARY

\define@key{beamerthemeirteslibraryslide}{frametitle}{%
	\gdef\beamer@theme@irtes@libraryslide@frametitle{#1}%
}
\define@key{beamerthemeirteslibraryslide}{subtitle}{%
	\gdef\beamer@theme@irtes@libraryslide@subtitle{#1}%
}
% \libraryslide[frametitle=text,subtitle=text]{picture}{title}{authors}{How published}{ISBN}
\newcommand{\libraryslide}[6][]{%
	\beamer@theme@irtes@optlist{#1}%
	\gdef\beamer@theme@irtes@libraryslide@frametitle{\subsecname}%
	\gdef\beamer@theme@irtes@libraryslide@subtitle{}%
	\ifbeamer@theme@irtes@optlist@needdefault%
		\setkeys{beamerthemeirteslibraryslide}{subtitle=#1}%
	\else%
		\setkeys{beamerthemeirteslibraryslide}{#1}%
	\fi%
	\begin{frame}[c]{\beamer@theme@irtes@libraryslide@frametitle}%
		\raisebox{-\height}{\fbox{\includegraphics[width=3cm]{#2}}}\hfill%
		\begin{minipage}[t]{.65\linewidth}
		\begin{raggedright}
		\mbox{}\\%
		\nohyphens{\textbf{#3}}
		\ifthenelse{\equal{a\beamer@theme@irtes@libraryslide@subtitle}{a}}{}{%
			\\ \nohyphens{\small\beamer@theme@irtes@libraryslide@subtitle}%
		} \\[.5cm]%
		\nohyphens{#4} \\[.5cm]%
		\nohyphens{#5} \\[.25cm]%
		\nohyphens{ISBN #6}%
		\end{raggedright}
		\end{minipage}%
	\end{frame}%
}

%---------------------------------------------
% Colorized tabulars

\arrayrulecolor{IRTESblue}
\def\chead#1{\textcolor{white}{#1}}%
\def\tabularheading{\rowcolor{IRTESlightblue}}%

%---------------------------------------------
% Continuation

\newcommand{\insertcontinuationwith}[1]{%
	\global\beamer@autobreakcount=#1%
	\usebeamertemplate****{}%
}

\endinput
