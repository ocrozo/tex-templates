% Copyright (c) 2013-14 Stephane GALLAND <galland@arakhne.org>
%
% UTBM, IRTES  and SET logos and names are registered and owned by the
% "Universite de Technology of Belfort-Montbeliard".
% 
% This program is free library; you can redistribute it and/or modify
% it under the terms of the GNU Lesser General Public License as
% published by the Free Software Foundation; either version 3 of the
% License, or any later version.
%
% This library is distributed in the hope that it will be useful, but
% WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
% Lesser General Public License for more details.
%
% You should have received a copy of the GNU Lesser General Public
% License along with this library; see the file COPYING.  If not,
% write to the Free Software Foundation, Inc., 59 Temple Place - Suite
% 330, Boston, MA 02111-1307, USA.
%
\ProvidesPackage{beamerouterthemeIRTES}
   [2014/09/10 Beamer Outer 'IRTES' Theme]

\mode<presentation>

\useoutertheme{default}

\gdef\beamer@theme@irtes@outer@offsety{0}

\newlength\beamer@theme@irtes@outer@linewidth
\setlength\beamer@theme@irtes@outer@linewidth{\paperwidth}
\addtolength{\beamer@theme@irtes@outer@linewidth}{-2em}

\newlength\beamer@theme@irtes@outer@titlewidth
\setlength\beamer@theme@irtes@outer@titlewidth{\paperwidth}
\addtolength{\beamer@theme@irtes@outer@titlewidth}{-9em}

\newlength\beamer@theme@irtes@outer@titlewidth@plain
\setlength\beamer@theme@irtes@outer@titlewidth@plain{\textwidth}

\newlength\beamer@theme@irtes@outer@sideboxwidth
\setlength\beamer@theme@irtes@outer@sideboxwidth{6.8cm}

\pgfdeclareimage[width=\paperwidth,height=\paperheight]{IRTESbackground}{IRTESbackground}
\pgfdeclareimage[width=\paperwidth,height=\paperheight]{IRTEStitle}{IRTEStitle}

% No navigation symbols
\setbeamertemplate{navigation symbols}{}

% Use the IRTES logo in the title
\useheaderlinewithirteslogo%

\setbeamertemplate{title page}{%
		\expandafter\begin{picture}(0,0)(0,\beamer@theme@irtes@outer@offsety)%
		\put(-28.5,-153){\pgfuseimage{IRTEStitle}}%
		\put(-20,-25){\usebeamercolor[fg]{frametitle}\parbox[c]{\beamer@theme@irtes@outer@linewidth}{%
			\nohyphens{\begin{flushleft}\LARGE\textbf{\@beamer@theme@irtes@wraptextformats{\inserttitle}}%
			\ifthenelse{\boolean{beamer@theme@irtes@eventintitlebar}}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{%
					\ifthenelse{\equal{a\inserteventname}{a}}{%
					}{%
						\\\footnotesize\inserteventname%
					}%
				}{%
					\\\footnotesize\insertsubtitle%
				}%
			}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{}{%
					\\\footnotesize\insertsubtitle%
				}
			}%
			\end{flushleft}}}}%
		\put(-20,-95){\parbox[c]{\beamer@theme@irtes@outer@linewidth}{\begin{center}
			{\usebeamercolor[fg]{author}\large\bf\insertauthor}
			\ifthenelse{\boolean{beamer@theme@irtes@eventintitlebar}}{%
				\ifthenelse{\equal{a\insertsubtitle}{a}}{}{%
					\ifthenelse{\equal{a\inserteventname}{a}}{{}}{\\[.1cm]\usebeamercolor[fg]{author}\footnotesize\inserteventname}%
				}%
			}{%
				\ifthenelse{\equal{a\inserteventname}{a}}{}{%
					\\\usebeamercolor[fg]{author}\footnotesize\inserteventname%
				}%
			}%
			\end{center}}}%
		\put(60,-141){\tiny\parbox[c]{\beamer@theme@irtes@outer@linewidth}{\begin{flushleft}%
			{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute}\end{flushleft}}}%
		\put(257,-147.5){\parbox[b]{2.5cm}{\mbox{}\hfill\beamer@theme@irtes@partnerlogo}}%
		\end{picture}%

}

\setbeamertemplate{part page}{%
		\begin{picture}(0,0)(0,0)%
		\put(-20,-39){\usebeamercolor[fg]{frametitle}\parbox[c]{\beamer@theme@irtes@outer@linewidth}{%
			\nohyphens{\begin{flushleft}\LARGE\textbf{\@beamer@theme@irtes@wraptextformats{{\insertpartprefix}\beamer@partname}}%
		\end{flushleft}}}}%
		\put(257,-163.25){\parbox[b]{2.5cm}{\mbox{}\hfill\beamer@theme@irtes@partnerlogo}}%
		\ifbeamer@theme@irtes@part@hasauthor%
		\put(-20,-95){\parbox[c]{\beamer@theme@irtes@outer@linewidth}{\begin{center}
			{\usebeamercolor[fg]{author}\large\bf\beamer@theme@irtes@part@theauthor}
			\end{center}}}%
		\fi%
		\end{picture}%
}

\setbeamertemplate{frametitle}{%
		\ifbeamer@plainframe%
			\begin{picture}(0,40)(0,0)%
			% Header
			\put(-10,9){\usebeamercolor[fg]{plain frametitle}%
				\parbox[c]{\beamer@theme@irtes@outer@titlewidth@plain}{%
				\nohyphens{\begin{flushleft}\large\bf\@beamer@theme@irtes@wraptextformats{\insertframetitle\ \insertframetitle\ \insertframetitle\ \insertframetitle\ \insertframetitle}%
				\ifthenelse{\equal{a\insertframesubtitle}{a}}{{}}{%
					\usebeamercolor[fg]{plain framesubtitle}\small\bf~--~\@beamer@theme@irtes@wraptextformats{\insertframesubtitle}}%
				\end{flushleft}}%
			}}%
			\end{picture}%
		\else%
			\begin{picture}(0,40)(0,0)%
			% Header
			\put(60,9){\usebeamercolor[fg]{frametitle}%
				\parbox[c]{\beamer@theme@irtes@outer@titlewidth}{%
				\nohyphens{\begin{flushleft}\large\bf\@beamer@theme@irtes@wraptextformats{\insertframetitle}%
				\ifthenelse{\equal{a\insertframesubtitle}{a}}{{}}{%
					\usebeamercolor[fg]{framesubtitle}\small\bf~--~\@beamer@theme@irtes@wraptextformats{\insertframesubtitle}}%
				\end{flushleft}}%
			}}%
			% Side note
			\ifx\beamer@theme@irtes@sidenote\relax\else%
				\put(328,-210){\rotatebox{90}{\parbox[c]{\beamer@theme@irtes@outer@sideboxwidth}{%
						\usebeamerfont{sidenote}\usebeamercolor[fg]{sidenote}%
						\beamer@theme@irtes@sidenote%
				}}}%
				\global\let\beamer@theme@irtes@sidenote\relax%
			\fi%
			% Absolute elements
			\beamer@theme@irtes@insertabsolutepositionelements%
			% Frame number
			\put(290,31){\parbox[c]{3em}{%
				{\mbox{}\hfill\usebeamercolor[fg]{frametitle}\tiny\insertframenumbering}%
			}}%
			% Partner logo
			\put(257,-228){\parbox[b]{2.5cm}{\mbox{}\hfill\beamer@theme@irtes@partnerlogo}}%
			\end{picture}%
		\fi%
}

\gdef\beamer@theme@irtes@outer@footline{%
	\ifbeamer@plainframe\else%
	\begin{picture}(0,25)(0,0)%
	\put(85,8){\parbox[c]{\beamer@theme@irtes@outer@titlewidth}{%
			\usebeamerfont{author in head/foot}\usebeamercolor[fg]{author in head/foot}%
			\insertshortauthor%
			\@beamer@theme@irtes@postfix{~--~}{\insertshorteventname}%
			\insertshortinstitute}}%
	\end{picture}%
	\fi%
}

\newcommand{\beamer@theme@irtes@outer@thanksslide}{%
	\beamer@theme@irtes@nav@advancesection%
	\xdef\beamer@theme@irtes@totalcoreframenumber{\the\c@framenumber}
	\addtocounter{section}{1}% To be sure that the 'thank' slide is not in the same section as the previous slide.
	\setbeamertemplate{footline}{}
	\usebackgroundtemplate{\pgfuseimage{IRTEStitle}}%
	\useheaderempty
	\frame{
		\ifthenelse{\value{@beamer@theme@irtes@finalslidelabel}=3}{%
			\gdef\beamer@theme@irtes@outer@offsety{15}%
			\usebeamertemplate{title page}%
			\gdef\beamer@theme@irtes@outer@offsety{0}%
		}{%
		\begin{picture}(0,10)(0,0)%
		\put(-20,-38.5){\usebeamercolor[fg]{frametitle}\parbox[c]{\beamer@theme@irtes@outer@linewidth}{%
			\nohyphens{\begin{flushleft}\LARGE\textbf{%
				\ifcase\value{@beamer@theme@irtes@finalslidelabel}%
					\translate{Thanks}%
				\or%
					\translate{Questions}%
				\or%
					\beamer@theme@irtes@label@finalslidelabel%
				\else%
					\errmessage{Package Beamer/IRTES: Unsupported type of message for the final slide.}%
				\fi%
			}\end{flushleft}}}}%
		\put(60,-155){\tiny\parbox[c]{\beamer@theme@irtes@outer@linewidth}{%
			{\usebeamercolor[fg]{institute}\insertinstitute}}}%
		\put(257,-163.25){\parbox[b]{2.5cm}{\mbox{}\hfill\beamer@theme@irtes@partnerlogo}}%
		\end{picture}%
		}%
	}
	\usebackgroundtemplate{\ifbeamer@plainframe\else\pgfuseimage{IRTESbackground}\fi}
	\setbeamertemplate{footline}{\beamer@theme@irtes@outer@footline}
	\useheaderdefault
}

\setbeamertemplate{frametitle continuation}{%
	{\smaller(\#\insertcontinuationcount)}%
}

\mode
<all>
